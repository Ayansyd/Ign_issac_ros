<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from four_diff_drive.xacro          | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="four_diff_drive">

  <!-- changed by Anisha 12/11/2024 -->
  <!-- <plugin>
    filename="gz-sim-scene-broadcaster-system"
    name="gz::sim::systems::SceneBroadcaster"
  </plugin> -->

  <material name="silver">
    <color rgba="0.700 0.700 0.700 1.000"/>
  </material>
  <transmission name="fr_joint_tran">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="fr_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="fr_joint_actr">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="fl_joint_tran">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="fl_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="fl_joint_actr">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="rr_joint_tran">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="rr_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="rr_joint_actr">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="rl_joint_tran">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="rl_joint">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="rl_joint_actr">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <!--<gazebo>
    <plugin filename="libign_ros2_control-system.so" name="control"/>
  </gazebo> -->
  <gazebo reference="base_link">
    <material>Gazebo/Silver</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <self_collide>true</self_collide>
    <gravity>true</gravity>
  </gazebo>
  <gazebo reference="fr_wheel_1_1">
    <material>Gazebo/Silver</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <self_collide>true</self_collide>
  </gazebo>
  <gazebo reference="fl_wheel_1_1">
    <material>Gazebo/Silver</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <self_collide>true</self_collide>
  </gazebo>
  <gazebo reference="rr_wheel_1_1">
    <material>Gazebo/Silver</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <self_collide>true</self_collide>
  </gazebo>
  <gazebo reference="rl_wheel_1_1">
    <material>Gazebo/Silver</material>
    <mu1>0.2</mu1>
    <mu2>0.2</mu2>
    <self_collide>true</self_collide>
  </gazebo>
  <link name="world_link"/>
  <link name="odom"/>    <!--changed from world_link to odom-->
  <link name="base_link">   <!-- changed z as +0.1 in inertial, visual, collision in base and 4 wheel links - anisha -->
    <inertial>
      <origin rpy="0 0 0" xyz="0.38933319773372493 0.025457111892628326 0.14121510359167855"/>
      <mass value="109.04860734197118"/>
      <inertia ixx="13.295168" ixy="-0.010501" ixz="0.044683" iyy="14.356455" iyz="0.671179" izz="2.822404"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <link name="fr_wheel_1_1">
    <inertial>
      <origin rpy="0 0 0" xyz="-0.0006678192662164517 7.879899210916363e-08 -5.297525051961571e-08"/>  <!-- z: -5.297525051961571e-08 to -0.628175 : anisha-->>
      <mass value="13.66073272140364"/>
      <inertia ixx="0.11786" ixy="-0.0" ixz="0.0" iyy="0.062234" iyz="0.0" izz="0.062234"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="-0.177234 0.134788 -0.628175"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/fr_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.177234 0.134788 -0.628175"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/fr_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <link name="fl_wheel_1_1">
    <inertial>
      <origin rpy="0 0 0" xyz="0.0006669561985305217 1.5491755467333945e-07 -1.2909381374992535e-07"/>  <!-- changed z: -1.2909381374992535e-07 to -0.628175 : anisha-->
      <mass value="13.660732721403573"/>
      <inertia ixx="0.11786" ixy="-0.0" ixz="0.0" iyy="0.062234" iyz="0.0" izz="0.062234"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="-0.599734 0.134788 -0.628175"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/fl_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.599734 0.134788 -0.628175"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/fl_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <link name="rr_wheel_1_1">
    <inertial>
      <origin rpy="0 0 0" xyz="-0.0006678192662164517 1.9850436036583652e-07 -1.2911571540402678e-07"/>  <!-- changed z: -1.2911571540402678e-07 to 0.038075 : anisha-->
      <mass value="13.660732721403626"/>
      <inertia ixx="0.11786" ixy="-0.0" ixz="-0.0" iyy="0.062234" iyz="-0.0" izz="0.062234"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="-0.177234 0.134788 0.038075"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/rr_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.177234 0.134788 0.038075"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/rr_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <link name="rl_wheel_1_1">
    <inertial>
      <origin rpy="0 0 0" xyz="0.0006669561985307437 1.5491755470109503e-07 -1.291157157232159e-07"/>  <!-- changed z: -1.291157157232159e-07 to 0.038075 : anisha-->
      <mass value="13.660732721403523"/>
      <inertia ixx="0.11786" ixy="-0.0" ixz="0.0" iyy="0.062234" iyz="0.0" izz="0.062234"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="-0.599734 0.134788 0.038075"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/rl_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="-0.599734 0.134788 0.038075"/>
      <geometry>
        <mesh filename="file:///home/orinnano/IAST_stuff_2_test/install/four_diff_drive_description/share/four_diff_drive_description/meshes/rl_wheel_1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>
  <!-- change -->
  <joint name="world_frame" type="fixed">
    <origin rpy="0 0 0" xyz="0.0 0.0 0.245"/> <!-- rpy = 0 0 0 from 1.57 0 0 to keep it forward on the ground >> ayaan, changed z: 0.0 to 0.245 - anisha -->
    <parent link="world_link"/>
    <child link="odom"/>
  </joint>
  <joint name="odom_frame" type="fixed">
    <origin rpy="0 0 0" xyz="0.599734 -0.134788 1.028175"/>  <!-- z changed from 0.628175 to 1.028175, x: 0.599734 to 0.999734, y: -0.134788 to -0.434788 - anisha-->
    <parent link="odom"/>
    <child link="base_link"/>
  </joint>
  <joint name="fr_wheel_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.177234 -0.134788 0.628175"/>
    <parent link="base_link"/>
    <child link="fr_wheel_1_1"/>
    <axis xyz="1.0 0.0 0.0"/>
  </joint>
  <joint name="fl_wheel_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.599734 -0.134788 0.628175"/>
    <parent link="base_link"/>
    <child link="fl_wheel_1_1"/>
    <axis xyz="1.0 0.0 0.0"/>
  </joint>
  <joint name="rr_wheel_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.177234 -0.134788 -0.038075"/>
    <parent link="base_link"/>
    <child link="rr_wheel_1_1"/>
    <axis xyz="1.0 0.0 0.0"/>
  </joint>
  <joint name="rl_wheel_joint" type="continuous">
    <origin rpy="0 0 0" xyz="0.599734 -0.134788 -0.038075"/>
    <parent link="base_link"/>
    <child link="rl_wheel_1_1"/>
    <axis xyz="1.0 0.0 0.0"/>
  </joint>
  <ros2_control name="IgnitionSystem" type="system">
    <hardware>
      <plugin>ign_ros2_control/IgnitionSystem</plugin>
    </hardware>
    <joint name="fr_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="fl_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="rr_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
    <joint name="rl_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
  </ros2_control>
  
  <gazebo>

<!--  #change#################Global odometer -->   
    <plugin
      filename="ignition-gazebo-odometry-publisher-system"
      name="ignition::gazebo::systems::OdometryPublisher">
      <odom_publish_frequency>50</odom_publish_frequency>
      <odom_topic>/odom</odom_topic>
      <odom_frame>odom</odom_frame>
      <robot_base_frame>base_link</robot_base_frame>
      <tf_topic>/odom/tf</tf_topic>
    </plugin>

    <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
   <!-- Remove <ros> tag. -->
   <!-- wheels -->
      <right_joint>fr_wheel_joint</right_joint>
      <left_joint>fl_wheel_joint</left_joint>
      <right_joint>rr_wheel_joint</right_joint>
      <left_joint>rl_wheel_joint</left_joint>
      <topic>/cmd_vel</topic> <!-- from <commant_topic> -->
      <!--<odom_topic>odom</odom_topic>  from <odometry_topic> commented out-->
      <frame_id>odom</frame_id> <!-- from <odometry_frame> changed from world_link to odom-->
      <child_frame_id>base_link</child_frame_id> <!-- from <robot_base_frame> -->
      <!--<odom_publisher_frequency>30</odom_publisher_frequency> from <update_rate> commented out-->
        <tf_topic>/tf</tf_topic> <!-- Short topic name for tf output -->
      </plugin>


      <plugin filename="ignition-gazebo-joint-group-velocity-controller-system"
            name="joint_group_velocity_controller">
         Define joints to be controlled by velocity 
        <joint_name>fr_wheel_joint</joint_name>
        <joint_name>fl_wheel_joint</joint_name>
        <joint_name>rr_wheel_joint</joint_name>
        <joint_name>rl_wheel_joint</joint_name>
        
         <!-- Set the command topic for the group velocity control -->
        <topic>/joint_group_velocity_controller/commands</topic>
        
         <!-- Optional parameters -->
        <update_rate>30</update_rate>   <!-- Update rate in Hz for the controller -->
      </plugin>
      
      </gazebo>
      </robot> 
  
  <!-- <plugin filename="gz-sim-joint-state-publisher-system"
  name="gz::sim::systems::JointStatePublisher">
     <topic>/joint_states</topic> 
     <joint_name>fr_wheel_joint</joint_name>
     <joint_name>fl_wheel_joint</joint_name>
     <joint_name>rr_wheel_joint</joint_name>
     <joint_name>rl_wheel_joint</joint_name>
  </plugin>-->


  
